#!/bin/bash

echo "üîß –†–ï–®–ï–ù–ò–ï –ö–û–ù–§–õ–ò–ö–¢–û–í ID"
echo "========================"
echo ""

# –°–æ–∑–¥–∞–µ–º backup
BACKUP_DIR="backup-id-fixes-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"

echo "üìÅ –°–æ–∑–¥–∞–Ω backup –≤: $BACKUP_DIR"
echo ""

# 1. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã —Å {id}
echo "1. üõ†Ô∏è –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –®–ê–ë–õ–û–ù–û–í:"
echo "--------------------------"

TEMPLATE_FILES="child-template-v3.md child-template.md master-template-v3.md master-template.md"

for file in $TEMPLATE_FILES; do
    if [ -f "$file" ]; then
        echo "üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: $file"
        cp "$file" "$BACKUP_DIR/"
        
        # –ó–∞–º–µ–Ω—è–µ–º {id} –Ω–∞ XX –≤ —à–∞–±–ª–æ–Ω–∞—Ö
        sed -i '' 's/id: "{id}"/id: "XX"/g' "$file"
        sed -i '' 's/id: "{hex_id}"/id: "XX"/g' "$file"
        echo "   ‚úÖ {id} ‚Üí XX"
    fi
done
echo ""

# 2. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã 04-02
echo "2. üõ†Ô∏è –ö–û–ù–§–õ–ò–ö–¢ 04-02:"
echo "-------------------"
echo "–§–∞–π–ª—ã:"
echo "  A) 04-02 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.md"
echo "  B) 04-02 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ 20251225.md"
echo ""
echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:"
echo "  A) –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ 04-02 (—Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)"
echo "  B) –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ 04-0A (—Å–Ω–∞–ø—à–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)"
echo ""
read -p "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª B –Ω–∞ 04-0A? [y/N]: " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    OLD_FILE="04-02 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ 20251225.md"
    NEW_ID="04-0A"
    NEW_FILE="${NEW_ID} - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ 20251225.md"
    
    if [ -f "$OLD_FILE" ]; then
        echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: $OLD_FILE ‚Üí $NEW_FILE"
        cp "$OLD_FILE" "$BACKUP_DIR/"
        
        # –ú–µ–Ω—è–µ–º ID –≤ —Ñ–∞–π–ª–µ
        sed -i '' "s/id: \"04-02\"/id: \"$NEW_ID\"/g" "$OLD_FILE"
        
        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª
        mv "$OLD_FILE" "$NEW_FILE"
        echo "   ‚úÖ ID –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ $NEW_ID"
        echo "   ‚úÖ –§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω"
    fi
fi
echo ""

# 3. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç 04-02-08
echo "3. üõ†Ô∏è –ö–û–ù–§–õ–ò–ö–¢ 04-02-08:"
echo "----------------------"
echo "–§–∞–π–ª—ã:"
echo "  A) 04-02-08 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –ø–æ –∏—Ç–æ–≥—É –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á 20251227.md"
echo "  B) 04-02-08 - –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ uch-docs.md"
echo ""
echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:"
echo "  A) –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ 04-02-09 (—Å–Ω–∞–ø—à–æ—Ç —É—Å—Ç–∞—Ä–µ–ª)"
echo "  B) –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ 04-02-08 (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞)"
echo ""
read -p "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª A –Ω–∞ 04-02-09? [y/N]: " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    OLD_FILE="04-02-08 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –ø–æ –∏—Ç–æ–≥—É –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á 20251227.md"
    NEW_ID="04-02-09"
    NEW_FILE="${NEW_ID} - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –ø–æ –∏—Ç–æ–≥—É –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á 20251227.md"
    
    if [ -f "$OLD_FILE" ]; then
        echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: $OLD_FILE ‚Üí $NEW_FILE"
        cp "$OLD_FILE" "$BACKUP_DIR/"
        
        # –ú–µ–Ω—è–µ–º ID –≤ —Ñ–∞–π–ª–µ
        sed -i '' "s/id: \"04-02-08\"/id: \"$NEW_ID\"/g" "$OLD_FILE"
        
        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª
        mv "$OLD_FILE" "$NEW_FILE"
        echo "   ‚úÖ ID –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ $NEW_ID"
        echo "   ‚úÖ –§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω"
    fi
fi
echo ""

# 4. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç 04-03
echo "4. üõ†Ô∏è –ö–û–ù–§–õ–ò–ö–¢ 04-03:"
echo "-------------------"
echo "–§–∞–π–ª—ã:"
echo "  A) 04-03 - –°–Ω–∞–ø—à–æ—Ç –ø–æ –∏—Ç–æ–≥—É –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á 20251227.md"
echo "  B) 04-03 - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.md"
echo ""
echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:"
echo "  A) –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ 04-03 (—Å–Ω–∞–ø—à–æ—Ç)"
echo "  B) –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ 04-0B (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)"
echo ""
read -p "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª B –Ω–∞ 04-0B? [y/N]: " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    OLD_FILE="04-03 - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.md"
    NEW_ID="04-0B"
    NEW_FILE="${NEW_ID} - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.md"
    
    if [ -f "$OLD_FILE" ]; then
        echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: $OLD_FILE ‚Üí $NEW_FILE"
        cp "$OLD_FILE" "$BACKUP_DIR/"
        
        # –ú–µ–Ω—è–µ–º ID –≤ —Ñ–∞–π–ª–µ
        sed -i '' "s/id: \"04-03\"/id: \"$NEW_ID\"/g" "$OLD_FILE"
        
        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª
        mv "$OLD_FILE" "$NEW_FILE"
        echo "   ‚úÖ ID –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ $NEW_ID"
        echo "   ‚úÖ –§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω"
    fi
fi
echo ""

# 5. –†–µ—à–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç 04-04
echo "5. üõ†Ô∏è –ö–û–ù–§–õ–ò–ö–¢ 04-04:"
echo "-------------------"
echo "–§–∞–π–ª—ã:"
echo "  A) 04-04 - –°–Ω–∞–ø—à–æ—Ç —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ 20251228.md"
echo "  B) 04-04 - –ë—Ä–µ–Ω–¥–±—É–∫ UCH - UniversalCreativeHub.md"
echo ""
echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:"
echo "  A) –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ 04-04 (—Å–Ω–∞–ø—à–æ—Ç)"
echo "  B) –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ 04-0C (–±—Ä–µ–Ω–¥–±—É–∫)"
echo ""
read -p "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª B –Ω–∞ 04-0C? [y/N]: " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    OLD_FILE="04-04 - –ë—Ä–µ–Ω–¥–±—É–∫ UCH - UniversalCreativeHub.md"
    NEW_ID="04-0C"
    NEW_FILE="${NEW_ID} - –ë—Ä–µ–Ω–¥–±—É–∫ UCH - UniversalCreativeHub.md"
    
    if [ -f "$OLD_FILE" ]; then
        echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: $OLD_FILE ‚Üí $NEW_FILE"
        cp "$OLD_FILE" "$BACKUP_DIR/"
        
        # –ú–µ–Ω—è–µ–º ID –≤ —Ñ–∞–π–ª–µ
        sed -i '' "s/id: \"04-04\"/id: \"$NEW_ID\"/g" "$OLD_FILE"
        
        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª
        mv "$OLD_FILE" "$NEW_FILE"
        echo "   ‚úÖ ID –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ $NEW_ID"
        echo "   ‚úÖ –§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω"
    fi
fi

echo ""
echo "‚úÖ –í–´–ü–û–õ–ù–ï–ù–û!"
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
echo "  ls -la *.md | grep '04-0'"
echo "  ./check-conflicts-simple.sh"
