#!/bin/bash
echo "üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ú–ï–ù –í FRONTMATTER"
echo "================================"
echo ""
echo "–£–¥–∞–ª—è–µ–º ID –∏ —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ –ø–æ–ª—è name"
echo "–û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è"
echo ""

fixed_count=0

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ UCH –¥–æ–∫—É–º–µ–Ω—Ç—ã
find . -name "[0-9Z]-*.md" -type f \
  -not -path "./backup*" \
  -not -path "./frontmatter-fixed-backup*" \
  -not -path "./archive*" \
  -not -path "./audit*" \
  -not -path "./uch-scripts/scripts-backup*" \
  -not -path "./blog*" | while read f; do
  
  filename=$(basename "$f")
  
  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∏–º—è –∏–∑ frontmatter
  current_name=$(grep -m1 "^name:" "$f" 2>/dev/null | cut -d: -f2- | sed 's/^ *//; s/ *$//; s/^"//; s/"$//')
  
  if [ -n "$current_name" ]; then
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∏–º—è –ø–∞—Ç—Ç–µ—Ä–Ω ID (—Ü–∏—Ñ—Ä—ã-–¥–µ—Ñ–∏—Å—ã –≤ –Ω–∞—á–∞–ª–µ)
    if [[ "$current_name" =~ ^[0-9]+-[0-9]+-[0-9]+ ]]; then
      # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
      file_id=$(echo "$filename" | grep -oE '^[0-9]+-[0-9]+-[0-9]+' | head -1)
      file_type=$(echo "$filename" | grep -oE '_[A-Z]+_' | sed 's/_//g')
      
      # –°–æ–∑–¥–∞–µ–º —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è –∏–∑ slug —á–∞—Å—Ç–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
      # –§–æ—Ä–º–∞—Ç: X-XXXXXX-X_TYPE_slug.md ‚Üí –±–µ—Ä–µ–º slug –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
      slug_part=$(echo "$filename" | sed "s/^${file_id}_${file_type}_//" | sed 's/\.md$//')
      
      # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º slug –≤ —á–∏—Ç–∞–µ–º–æ–µ –∏–º—è
      readable_name=$(echo "$slug_part" | 
        sed 's/_/ /g' |  # –ó–∞–º–µ–Ω—è–µ–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–±–µ–ª—ã
        sed 's/  / /g' | # –£–±–∏—Ä–∞–µ–º –¥–≤–æ–π–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
        sed 's/^[[:space:]]*//; s/[[:space:]]*$//' | # –û–±—Ä–µ–∑–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
        sed 's/\([a-z]\)\([A-Z]\)/\1 \2/g' | # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏ –≤ CamelCase
        sed 's/-/ - /g'  # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –≤–æ–∫—Ä—É–≥ –¥–µ—Ñ–∏—Å–æ–≤
      )
      
      # –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è
      readable_name=$(echo "$readable_name" | sed 's/^./\u&/')
      
      echo "üìù $filename"
      echo "   –ë—ã–ª–æ: $current_name"
      echo "   –°—Ç–∞–ª–æ: $readable_name"
      
      # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ —Ñ–∞–π–ª–µ
      sed -i '' "s/^name:.*$/name: \"$readable_name\"/" "$f"
      
      fixed_count=$((fixed_count + 1))
      echo ""
    fi
  fi
done

echo "========================================"
echo "üìä –ò–¢–û–ì: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–º–µ–Ω: $fixed_count"
echo ""
echo "üîç –ü–†–ò–ú–ï–†–´ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–• –ò–ú–ï–ù:"
echo "----------------------------"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã
example_files=(
  "4-010400-0200-1_TASK_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è_–≤–∏–ª–∫–∞_UCH-Docs.md"
  "4-010400-0600-1_TASK_–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ_—Å–æ–∑–¥–∞–Ω–∏–µ_ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö_–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.md"
  "6-010000-002-1_SNAP_20251225.md"
  "2-010400-7_ARCH_Documentation-first_–ø–æ–¥—Ö–æ–¥.md"
  "1-010000-6_BRAND_brandbook.md"
)

for example in "${example_files[@]}"; do
  if [ -f "$example" ]; then
    name=$(grep -m1 "^name:" "$example" | cut -d: -f2- | sed 's/^ *//; s/ *$//')
    echo "üìÑ $example:"
    echo "   $name"
    echo ""
  fi
done
