#!/bin/bash
# –ú–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ - —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -f "$SCRIPT_DIR/document-creator.sh" ]; then
    source "$SCRIPT_DIR/document-creator.sh"
fi

# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
create_document_improved() {
    echo ""
    echo "üìù –°–û–ó–î–ê–ù–ò–ï –î–û–ö–£–ú–ï–ù–¢–ê"
    echo ""
    
    # 1. –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è
    echo "=== –í–´–ë–û–† –£–†–û–í–ù–Ø –î–û–ö–£–ú–ï–ù–¢–ê ==="
    echo "1 - –ú–∞—Å—Ç–µ—Ä-–¥–æ–∫—É–º–µ–Ω—Ç (—É—Ä–æ–≤–µ–Ω—å 1, –∫–æ—Ä–Ω–µ–≤–æ–π)"
    echo "2 - –î–æ—á–µ—Ä–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (—É—Ä–æ–≤–µ–Ω—å 2+)"
    echo "3 - –ù–µ–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (–∏–¥–µ–∏, —Å—Å—ã–ª–∫–∏, –≤—Å—Ç—Ä–µ—á–∏)"
    echo ""
    read -p "–í–∞—à –≤—ã–±–æ—Ä (1-3): " level_choice
    
    local level=""
    local parent_id=""
    
    case $level_choice in
        1)
            level=1
            echo "–í—ã–±—Ä–∞–Ω: –ú–∞—Å—Ç–µ—Ä-–¥–æ–∫—É–º–µ–Ω—Ç (—É—Ä–æ–≤–µ–Ω—å 1)"
            ;;
        2)
            # –î–æ—á–µ—Ä–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è
            echo ""
            read -p "–í–≤–µ–¥–∏—Ç–µ ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 00 –∏–ª–∏ 00-01): " parent_id
            
            if [ -z "$parent_id" ]; then
                echo "‚ùå ID —Ä–æ–¥–∏—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
                return 1
            fi
            
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—é
            parent_level=$(echo "$parent_id" | tr -cd '-' | wc -c)
            level=$((parent_level + 2))
            echo "–û–ø—Ä–µ–¥–µ–ª–µ–Ω —É—Ä–æ–≤–µ–Ω—å: $level (—Ä–æ–¥–∏—Ç–µ–ª—å: $parent_id)"
            ;;
        3)
            level="N"
            echo "–í—ã–±—Ä–∞–Ω: –ù–µ–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç"
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            return 1
            ;;
    esac
    
    # 2. –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    echo ""
    read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞: " name
    if [ -z "$name" ]; then
        echo "‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
        return 1
    fi
    
    # 3. –í—ã–±–æ—Ä —Ç–∏–ø–∞
    echo ""
    if [ -f "$SCRIPT_DIR/types.sh" ]; then
        source "$SCRIPT_DIR/types.sh"
        show_type_menu_for_level "$level"
        type=$(select_type_by_number "$level")
    else
        type=$(get_default_type_for_level "$level")
    fi
    
    # 4. –¢–µ–≥–∏
    echo ""
    read -p "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): " tags
    
    # 5. –°–≤–æ–¥–∫–∞
    echo ""
    echo "üìã –°–í–û–î–ö–ê:"
    echo "  –ù–∞–∑–≤–∞–Ω–∏–µ: $name"
    echo "  –£—Ä–æ–≤–µ–Ω—å: $level"
    echo "  –¢–∏–ø: $type"
    if [ -n "$parent_id" ]; then
        echo "  –†–æ–¥–∏—Ç–µ–ª—å: $parent_id"
    fi
    echo "  –¢–µ–≥–∏: ${tags:-–Ω–µ—Ç}"
    echo ""
    
    read -p "–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç? (y/n): " confirm
    if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        return 0
    fi
    
    # 6. –†–µ–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    echo ""
    if [ -f "$SCRIPT_DIR/document-creator.sh" ]; then
        if create_real_document "$name" "$level" "$type" "$parent_id" "$tags"; then
            echo ""
            echo "üéâ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"
        else
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞"
        fi
    else
        echo "‚ö†Ô∏è  –ú–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω"
        echo "   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞"
        echo "   ID: (–±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)"
        echo "   –§–∞–π–ª: (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω)"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
create_batch_documents() {
    echo "‚ö†Ô∏è  –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"
}
