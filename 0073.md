1. Введение
1.1. Цель документа
Формализовать требования к доработке веб-интерфейса EPG для управления клиентскими сертификатами, включая их подписание, хранение, контроль срока действия и уведомления.

1.2. Контекст и проблема
В текущем процессе выпуска сертификатов для партнёров (мерчантов) используется ручное взаимодействие с OpenSSL, что требует специальных знаний и усложняет регистрацию новых партнёров.
Требуется упростить и частично автоматизировать процесс выпуска, подписания и контроля сертификатов через веб-интерфейс EPG.

2. Бизнес-требования
2.1. Цели
Создать единый интерфейс для управления сертификатами партнёров в рамках EPG.

Упростить процесс выпуска сертификатов для операторов.

Обеспечить контроль сроков действия сертификатов и уведомления об истечении.

Исключить необходимость использования сторонних инструментов (например, OpenSSL вручную).

2.2. Ожидаемые результаты
Оператор может выпустить сертификат для мерчанта в процессе его регистрации.

Администратор видит список всех сертификатов с информацией о сроке действия.

Автоматические уведомления отправляются ответственным лицам перед истечением срока действия сертификата.

3. Функциональные требования
3.1. Страница управления сертификатами
Экран: Отдельный раздел в веб-интерфейсе EPG.

Элементы:

Таблица со списком сертификатов, содержащая колонки:

Логин пользователя API

Логин мерчанта (MID/TID)

Subject сертификата

Серийный номер сертификата

Дата истечения срока действия

Визуальное выделение строк:

Красный — срок истёк.

Жёлтый — осталось менее N дней (N настраивается).

Фильтры/поиск по:

Логину пользователя API

Логину мерчанта

Subject сертификата

3.2. Загрузка CA (центра удостоверения)
Функционал:

Возможность загрузки CA-сертификата и приватного ключа в JKS-хранилище EPG.

Настройка alias для CA в конфигурации EPG.

3.3. Подписание CSR (запрос на подпись сертификата)
Сценарий 1: Через отдельную форму

Кнопка "Подписать сертификат" → открывает модальное окно с полями:

Логин пользователя API (с поиском и автоподстановкой мерчанта).

Поле для загрузки файла CSR (.csr).

Кнопка "Подписать" → выполняет подписание с использованием загруженного CA.

После успешного подписания:

Запись добавляется в таблицу сертификатов.

Показывается ссылка/кнопка для скачивания CRT.

При ошибке подписания — отображение понятного сообщения об ошибке.

Сценарий 2: При создании пользователя API

Если у пользователя есть разрешение "Use Merchant API", отображается поле для загрузки CSR.

При загрузке CSR автоматически подписывается и добавляется в список сертификатов.

3.4. Скачивание сертификата
В таблице сертификатов — кнопка "Скачать CRT" для каждой записи.

На форме списка пользователей — если у пользователя есть действующие сертификаты, отображается кнопка "Скачать сертификат" (скачивается CRT с самым поздним сроком действия).

3.5. Удаление записей
Кнопка "Удалить" в таблице сертификатов для удаления устаревших или ошибочных записей.

3.6. Уведомления об истечении срока действия
Механизм:

Фоновое задание (расписание) проверяет срок действия сертификатов.

Отправляет email-уведомления, если:

Срок действия истекает через N дней (настраиваемо).

Срок уже истёк.

Адреса для уведомлений настраиваются:

Глобально (системная настройка) — для ответственных сотрудников банка.

На уровне сертификата (при подписании) — для ответственных лиц мерчанта.

4. Нефункциональные требования
4.1. Безопасность
Приватный ключ CA хранится в JKS-хранилище с защитой.

Доступ к разделу управления сертификатами — только для пользователей с соответствующими правами.

4.2. Надёжность
Обработка ошибок подписания CSR с понятными сообщениями в интерфейсе.

Логирование всех операций с сертификатами.

4.3. Производительность
Таблица сертификатов должна поддерживать пагинацию/фильтрацию при большом количестве записей.

5. Ограничения и допущения
5.1. Ограничения
EPG не проверяет клиентские сертификаты при вызовах API — это задача nginx.

Ключи партнёров не хранятся в EPG (только сертификаты).

5.2. Допущения
CA-сертификат и ключ предоставляются заказчиком.

Формат CSR — стандартный PEM/DER, совместимый с OpenSSL.

6. Сценарии использования
6.1. Выпуск сертификата для нового партнёра
Оператор создаёт пользователя API с разрешением "Use Merchant API".

Загружает CSR от партнёра.

Система автоматически подписывает CSR с использованием CA.

Сертификат добавляется в список, становится доступным для скачивания.

Партнёру отправляется CRT.

6.2. Контроль сроков действия
Ежедневно система проверяет сроки действия сертификатов.

Если до истечения срока осталось менее 30 дней (значение настраивается), отправляется уведомление на email из системных настроек и/или указанные при подписании.

В интерфейсе запись подсвечивается жёлтым/красным.

7. Интерфейсы и интеграции
7.1. Внутренние
Модуль управления пользователями EPG.

Система настроек EPG.

JKS-хранилище для CA.

7.2. Внешние
Отсутствуют (вся логика работает внутри EPG).

8. Термины и определения
CA — центр сертификации, удостоверяющий подлинность сертификатов.

CSR — запрос на подпись сертификата.

CRT — подписанный сертификат.

JKS — Java KeyStore, хранилище ключей и сертификатов.

Subject — поле в сертификате, идентифицирующее владельца.

9. Приложения
Приложение A: Макеты интерфейса (отдельный файл).

Приложение B: Примеры CSR/CRT (по запросу).