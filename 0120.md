# **Анализ запроса: Изменение логики списания комиссии за SMS-информирование**

## **Понимание задачи**

Заказчик хочет изменить процесс взимания комиссии за платную услугу SMS-информирования по картам. Текущая логика включает сложные циклы повторных попыток списания в течение 30 дней при недостатке средств на счете клиента.

**Итоговая постановка (согласована в комментарии #19):**  
Бизнес упрощает логику до бинарного сценария, исключая любые повторные попытки списания или накопление долга.

**Новая цель:** Сделать процесс списания комиссии за SMS-сервис простым, предсказуемым и автоматически прекращающим услугу при первой же неудачной попытке оплаты.

## **Суть изменений: от сложного цикла к простому правилу**

|Аспект|Текущая логика (до изменений)|Новая требуемая логика|
|---|---|---|
|**Основной цикл**|30 дней (CYTP0132).|**Без изменений.** 30 дней (CYTP0132).|
|**Действие при достаточных средствах**|Списание полной суммы комиссии. Продление подписки на следующий цикл.|**Без изменений.** Списание полной суммы. Продление подписки.|
|**Действие при НЕдостаточных средствах**|Запуск **дополнительного 30-дневного цикла (S)** для ежедневных проверок баланса и попыток списания. Если за 30 дней средства так и не появятся, долг **аннулируется**, и цикл S запускается заново.|**Упрощено.** **Немедленное отключение SMS-сервиса.** Никаких списаний, никаких дополнительных циклов ожидания.|
|**Информирование клиента**|Неявное. Клиент может не знать, что услуга де-факто приостановлена из-за долга.|Явное. Отключение сервиса — четкий сигнал клиенту о необходимости действий для возобновления.|
|**Синхронизация с FE**|Не требуется.|**Требуется.** Информация об отключении сервиса должна быть передана в Front-End (FE) для актуализации статуса в карточных системах.|

## **Ключевые выводы для постановки**

1. **Убрать "сострадательную" логику:** Исключить все дополнительные циклы (S) и механизмы накопления/частичного списания долга. Процесс становится одношаговым.
    
2. **Добавить действие "отключение":** Ввести новое бизнес-действие — принудительное отключение платной услуги при неуспешной оплате.
    
3. **Обеспечить сквозное отключение:** Изменение статуса в Back-Office (BO) должно синхронизироваться с Front-End (FE), чтобы сервис был отключен на всех уровнях банковской системы.
    

**Итоговая задача для разработки:** **Модифицировать обработку события CYTP0132 ("Цикл для Комиссия за обслуживание sms-сервиса по карте") в системе Back-Office (BO), добавив ветку логики для немедленного отключения SMS-сервиса при недостатке средств и обеспечив передачу этого статуса в Front-End (FE).**

# **Бизнес-требования к изменению логики списания комиссии за SMS-информирование**

**Документ подготовлен:** Бизнес-аналитик  
**Версия:** 1.0  
**Дата:** [текущая дата]  
**Заинтересованные стороны:** Команда заказчика (RV, AM), Команда исполнителя (DZ, SN, MM)  
**Источник:** Заявка MHO0120

---

## **1. Контекст и описание проблемы**

В текущей реализации процесс списания ежемесячной комиссии за услугу SMS-информирования по карте включает механизм повторных попыток списания ("дополнительный цикл") в течение 30 дней в случае недостатка средств на счете клиента. Данная логика является избыточной и не соответствует новым бизнес-требованиям.

Бизнес принимает решение упростить процесс, перейдя к четкой и предсказуемой модели: если в расчетный день на счете клиента достаточно средств — комиссия списывается, и услуга продлевается. Если средств недостаточно — услуга немедленно отключается без создания долга и последующих попыток списания.

## **2. Цели проекта**

1. **Упрощение логики:** Ликвидировать сложные механизмы повторных попыток списания и обработки долга по комиссии за SMS-сервис.
    
2. **Повышение прозрачности:** Обеспечить для клиента четкую связь между оплатой и статусом услуги — неуплата приводит к немедленному отключению.
    
3. **Синхронизация статусов:** Гарантировать, что отключение услуги в расчетной системе (BO) актуализируется в карточном фронте (FE).
    

## **3. Текущая логика (AS-IS)**

Цикл взимания комиссии регулируется событием **CYTP0132** с периодом 30 дней.

1. В день наступления события система проверяет статус карты и доступный баланс.
    
2. При достаточном балансе: комиссия списывается полностью.
    
3. При недостаточном балансе: запускается **дополнительный 30-дневный цикл (S)** для ежедневных проверок баланса.
    
    - Если в течение этого цикла средства появляются, происходит списание, и основной цикл перезапускается.
        
    - Если средства не появляются, долг аннулируется, и цикл S запускается заново для следующего периода.
        

## **4. Требуемая логика (TO-BE)**

Требуется модифицировать обработку события **CYTP0132** в системе Back-Office (BO). Новая логика должна реализовывать следующий алгоритм:

**В день наступления события CYTP0132 система должна:**

1. **Проверить статус карты.** Обработка должна происходить только для карт, которые **не заблокированы** и **не находятся в процессе закрытия**.
    
2. **Оценить возможность списания:**
    
    - **ВАРИАНТ А: Средств ДОСТАТОЧНО.**
        
        - **Действие:** Произвести списание комиссии в полном объеме.
            
        - **Результат:** Услуга SMS-информирования считается оплаченной и остается активной на следующий расчетный цикл.
            
    - **ВАРИАНТ Б: Средств НЕДОСТАТОЧНО.**
        
        - **Действие 1:** Немедленно **отключить** услугу SMS-информирования для данной карты в системе BO. **Никакое списание комиссии (в том числе частичное) не производится.**
            
        - **Действие 2:** Передать информацию об отключении сервиса в систему **Front-End (FE)** для синхронизации статуса на всех уровнях.
            
        - **Результат:** Услуга деактивирована. Дополнительные циклы ожидания или накопление долга **не создаются**.
            

## **5. Детальные требования к реализации**

### **5.1. Требования к Back-Office (BO)**

1. **Новые модификаторы (проверяющие условия):**
    
    - Создать модификатор **"Денег достаточно для комиссии за SMS-сервис"**. Он должен возвращать `true`, если доступный баланс основного счета карты **больше или равен** размеру комиссии за SMS-сервис.
        
    - Создать модификатор **"Денег недостаточно для комиссии за SMS-сервис"**. Он должен возвращать `true`, если доступный баланс основного счета карты **меньше** размера комиссии за SMS-сервис.
        
2. **Новый набор правил:**
    
    - Создать **набор правил "Отключение SMS-сервиса"**, который будет выполняться при условии срабатывания модификатора "Денег недостаточно...". Действием этого набора должно быть отключение сервиса в BO.
        
3. **Конфигурация события CYTP0132:**
    
    - К существующему **набору правил "Взимание комиссии"** для события CYTP0132 должен быть прикреплен модификатор **"Денег достаточно для комиссии за SMS-сервис"**. Это гарантирует, что списание произойдет только при достаточном балансе.
        
    - К новому **набору правил "Отключение SMS-сервиса"** для события CYTP0132 должен быть прикреплен модификатор **"Денег недостаточно для комиссии за SMS-сервис"**.
        

### **5.2. Требование к интеграции с Front-End (FE)**

1. В рамках действия **"Отключение SMS-сервиса"** в BO необходимо инициировать процесс передачи соответствующего статуса в систему **Front-End (FE)**.
    
2. Механизм и формат передачи должны соответствовать существующим практикам интеграции между BO и FE.
    

## **6. Ограничения**

1. Частичное списание комиссии (списание доступной суммы с последующим досписанием) **не входит в scope** данной задачи.
    
2. Архитектурное изменение, при котором проверка баланса и списание комиссии будут происходить в **Front-End (FE)** или **Интеграционной платформе (IP)**, **не рассматривается**. Логика остается в рамках Back-Office (BO).
    
3. Все изменения должны быть обратимы: клиент должен иметь возможность повторно подключить услугу SMS-информирования через предусмотренные для этого каналы (например, через мобильное приложение или личный кабинет).
    

## **7. Термины и сокращения**

- **BO (Back-Office)** — бэк-офисная система, отвечающая за расчетные операции, ведение карточных продуктов и списание комиссий.
    
- **CYTP0132** — код события/цикла в системе BO, отвечающего за периодическое (раз в 30 дней) взимание комиссии за SMS-информирование.
    
- **FE (Front-End)** — фронт-эндовая карточная система (ядро), хранящая актуальный статус карт и подключенных к ним сервисов.
    
- **Модификатор (в контексте BO)** — правило или условие, которое проверяет определенные параметры (например, баланс счета) и возвращает булево значение (`true`/`false`).
    
- **Набор правил (в контексте BO)** — совокупность действий, которые выполняются при наступлении события при соблюдении прикрепленных к нему модификаторов.
    
- **SMS-информирование** — платная услуга, при которой клиент получает SMS-уведомления об операциях по своей карте.
    

---